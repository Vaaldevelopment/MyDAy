<div class="container-fluid pt-5">

  <div class="row mt-2 p-2 justify-content-center">

    <!-- Calendar -->
    <div class="col-xl-6 p-2">
      <!-- <div id="full-calendar"></div> -->
      <full-calendar id="calendar" defaultView="dayGridMonth" [plugins]="calendarPlugins" [weekends]="true"
        [eventLimit]="5" [events]="events" deepChangeDetection="true" [displayEventTime]="false"></full-calendar>
    </div>

    <div class="col-xl-6">
      <div class="row">
        <!-- LEave Application Form -->
        <div class="col-xl-8 p-2">
          <div *ngIf="!changeLeaveStatusFlag" class="bg-light border p-3">
            <h4 class="text-center">LEAVE APPLICATION</h4>
            <form *ngIf="!editLeaveFlag" #applyLeaveF="ngForm" ngNativeValidate (ngSubmit)="applyLeave()"
              id="applyLeaveForm">
              <div class="row">
                <div class="col-12 col-lg-6">
                  <div class="form-group">
                    <label for="fromDate">FROM</label>
                    <input type="date" class="form-control" name="fromDate" id="fromDate" aria-describedby="fromDate"
                      [(ngModel)]="userLeave.fromDate" (change)="checkleaveSpan()" required>
                    <!-- <span class="text-danger" *ngIf="fromDateerrorMessage">{{fromDatemessage}}</span> -->
                  </div>
                </div>

                <div class="col-12 col-lg-6">
                  <label for="fromSpan">FROM SPAN</label>
                  <select class="form-control" id="fromSpan" name="fromSpan" [(ngModel)]="userLeave.fromSpan" (change)="checkleaveSpan()">
                    <option value="FULL DAY">FULL DAY</option>
                    <option value="FIRST HALF">FIRST HALF</option>
                    <option value="SECOND HALF">SECOND HALF</option>
                  </select>
                </div>

              </div>

              <div class="row">

                <div class="col-12 col-lg-6">
                  <div class="form-group">
                    <label for="fromDate">TO</label>
                    <input type="date" class="form-control" name="to-date" id="toDate" aria-describedby="toDate"
                      [(ngModel)]="userLeave.toDate" (change)="checkleaveSpan()" required>
                    <!-- <span class="text-danger" *ngIf="toDateerrorMessage">{{toDatemessage}}</span> -->
                  </div>
                </div>

                <div class="col-12 col-lg-6">
                  <label for="toSpan">TO SPAN</label>
                  <select class="form-control" id="toSpan" name="toSpan" [(ngModel)]="userLeave.toSpan" (change)="checkleaveSpan()">
                    <option value="FULL DAY">FULL DAY</option>
                    <option value="FIRST HALF">FIRST HALF</option>
                    <option value="SECOND HALF">SECOND HALF</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-12">
                  <div class="form-group">
                    <label for="REASON">REASON</label>
                    <textarea class="form-control" name="reason" id="reason" rows="3" [(ngModel)]="userLeave.reason"
                      required tabindex="1"></textarea>
                  </div>
                </div>
              </div>
              <div class="row" *ngIf="leaveCountFlag">
                <div class="col-12">
                  <div class="form-group">
                    <label for="REASON">Leave Days</label>
                    <input type="number" class="form-control" name="leaveCount" id="leaveCount"
                      aria-describedby="leaveCount" [(ngModel)]="userLeave.leaveCount" disabled>
                  </div>
                </div>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="compOff" name="compOff"
                  [(ngModel)]="userLeave.compOff">
                <label class="form-check-label" for="compOff">
                  COMP OFF
                </label>
              </div>



              <div class="text-center pt-2">
                <button type="submit" class="btn btn-secondary" data-toggle="modal">APPLY
                  NOW</button>
                <!--*ngIf="apply" data-target="#sandwiched-popup"-->
                <button id="openModalButton" [hidden]="true" data-toggle="modal" data-target="#sandwiched-popup">Open
                  Modal</button>
              </div>
            </form>

            <form *ngIf="editLeaveFlag" #updateLeaveF="ngForm" ngNativeValidate (ngSubmit)="updateLeave()"
              id="updateLeaveForm">
              <div class="row">
                <div class="col-12 col-lg-6">
                  <div class="form-group">
                    <label for="fromDate">FROM</label>
                    <input type="date" class="form-control" name="fromDate" id="fromDate" aria-describedby="fromDate"
                      [(ngModel)]="userLeave.fromDate" (change)="checkHolidayDate()" required>
                    <!-- <span class="text-danger" *ngIf="fromDateerrorMessage">{{fromDatemessage}}</span> -->
                  </div>
                </div>

                <div class="col-12 col-lg-6">
                  <label for="fromSpan">FROM SPAN</label>
                  <select class="form-control" id="fromSpan" name="fromSpan" [(ngModel)]="userLeave.fromSpan">
                    <option value="FULL DAY">FULL DAY</option>
                    <option value="FIRST HALF">FIRST HALF</option>
                    <option value="SECOND HALF">SECOND HALF</option>
                  </select>
                </div>

              </div>

              <div class="row">

                <div class="col-12 col-lg-6">
                  <div class="form-group">
                    <label for="fromDate">TO</label>
                    <input type="date" class="form-control" name="to-date" id="toDate" aria-describedby="toDate"
                      [(ngModel)]="userLeave.toDate" (change)="checkHolidayDate()" required>
                    <!-- <span class="text-danger" *ngIf="toDateerrorMessage">{{toDatemessage}}</span> -->
                  </div>
                </div>

                <div class="col-12 col-lg-6">
                  <label for="toSpan">TO SPAN</label>
                  <select class="form-control" id="toSpan" name="toSpan" [(ngModel)]="userLeave.toSpan">
                    <option value="FULL DAY">FULL DAY</option>
                    <option value="FIRST HALF">FIRST HALF</option>
                    <option value="SECOND HALF">SECOND HALF</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-12">
                  <div class="form-group">
                    <label for="REASON">REASON</label>
                    <textarea class="form-control" name="reason" id="reason" rows="3" [(ngModel)]="userLeave.reason"
                      required tabindex="1"></textarea>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <div class="form-group">
                    <label for="REASON">Leave Days</label>
                    <input type="number" class="form-control" name="leaveCount" id="leaveCount"
                      aria-describedby="leaveCount" [(ngModel)]="userLeave.leaveCount" disabled>
                  </div>
                </div>
              </div>
              <!-- <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="compOff" name="compOff"
                  [(ngModel)]="userLeave.compOff">
                <label class="form-check-label" for="compOff">
                  COMP OFF
                </label>
              </div> -->
              <div class="row text-center">
                <div class="col-12">
                  <button class="btn btn-secondary" data-toggle="modal">UPDATE</button> &nbsp;
                  <button type="reset" class="btn btn-danger" data-toggle="modal"
                    (click)="backToApplyLeave(); updateLeaveF.reset()">CANCEL</button>
                  <button id="openModalButton" [hidden]="true" data-toggle="modal" data-target="#sandwiched-popup">Open
                    Modal</button>
                </div>
              </div>
              <!-- <div class="text-center pt-2">
                <div class="row justify-content-center">
                  <div class="col-12 col-lg-4">
                    <button class="btn btn-secondary" data-toggle="modal">UPDATE</button> &nbsp;
                    <button type="reset" class="btn btn-danger" data-toggle="modal"
                      (click)="backToApplyLeave(); updateLeaveF.reset()">CANCEL</button>
                  </div>
                </div>
              </div> -->
            </form>
          </div>
          <!----Leave Application Form Closed-->
          <!--Change LEave Status Form-->
          <div *ngIf="changeLeaveStatusFlag" class="bg-light border p-3">
            <h4 class="text-center">LEAVE APPLICATION</h4>
            <form *ngIf="!editLeaveFlag" #changeLeaveStatusForm="ngForm" ngNativeValidate
              (ngSubmit)="changeLeaveStatus()" id="LeaveStatusForm">
              <div class="row">
                <div class="col-12 col-lg-6">
                  <div class="form-group">
                    <label for="fromDate">FROM</label>
                    <input type="date" class="form-control" name="fromDate" id="fromDate" aria-describedby="fromDate"
                      [(ngModel)]="userLeave.fromDate" (change)="checkleaveSpan($event)" required>
                  </div>
                </div>
                <div class="col-12 col-lg-6">
                  <label for="fromSpan">FROM SPAN</label>
                  <select class="form-control" id="fromSpan" name="fromSpan" [(ngModel)]="userLeave.fromSpan">
                    <option>FULL DAY</option>
                    <option>FIRST HALF</option>
                    <option>SECOND HALF</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="col-12 col-lg-6">
                  <div class="form-group">
                    <label for="fromDate">TO</label>
                    <input type="date" class="form-control" name="to-date" id="toDate" aria-describedby="toDate"
                      [(ngModel)]="userLeave.toDate" (change)="checkleaveSpan()" required>
                  </div>
                </div>
                <div class="col-12 col-lg-6">
                  <label for="toSpan">TO SPAN</label>
                  <select class="form-control" id="toSpan" name="toSpan" [(ngModel)]="userLeave.toSpan">
                    <option>FULL DAY</option>
                    <option>FIRST HALF</option>
                    <option>SECOND HALF</option>
                  </select>
                </div>
              </div>

              <div class="row">
                <div class="col-12">
                  <div class="form-group">
                    <label for="REASON">REASON</label>
                    <textarea class="form-control" name="reason" id="reason" rows="3" [(ngModel)]="userLeave.reason"
                      required tabindex="1"></textarea>
                  </div>
                </div>
              </div>
              <div class="row" *ngIf="leaveCountFlag">
                <div class="col-12">
                  <div class="form-group">
                    <label for="REASON">Leave Days</label>
                    <input type="number" class="form-control" name="leaveCount" id="leaveCount"
                      aria-describedby="leaveCount" [(ngModel)]="userLeave.leaveCount" disabled>
                  </div>
                </div>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="addNote" name="addNote"
                  [(ngModel)]="addNoteFlag">
                <label class="form-check-label" for="addNote">
                  Add Note
                </label>
              </div>
              <div class="row mt-2" *ngIf="addNoteFlag">
                <div class="col-12">
                  <div class="form-group">
                    <input class="form-control" type="text" name="managerNote" id="managerNote"
                      [(ngModel)]="userLeave.managerNote">
                  </div>
                </div>
              </div>

              <div class="text-center pt-2">
                <button (click)="approvedLeave()" class="btn btn-secondary">APPROVE</button> &nbsp;
                <button *ngIf="takenButtonFlag" (click)="takenLeave()" class="btn btn-danger">TAKEN</button> &nbsp;
                <button *ngIf="!takenButtonFlag" (click)="rejectLeave()" class="btn btn-danger">REJECT</button>
              </div>
            </form>
          </div>
          <!--Change Leave Application Form Closed-->
        </div>

        <div class="col-xl-4 pt-2">

          <div class="row pb-2">
            <!-- Chart -->
            <div class="col-xl-12 border bg-light ">
              <div class="h-100 p-3 text-center ">
                <h4>LEAVE BALANCE <span class="total" name="leaveBalance"
                    [innerHTML]="this.userLeave.leaveBalance"></span></h4>
                    <p class="mb-0">FUTURE LEAVE <span class="font-weight-bold" name="futureLeaveBalance"
                      [innerHTML]="this.userLeave.futureLeave"></span></p>
                <div id="myChart"></div>
              </div>
            </div>
            <!-- Chart -->
          </div>

          <!-- Red Panel Upcoming Holidays -->
          <div class="row">
            <div class="col-lg-12 bg-red text-white px-3 py-3">
              <h4 class="">UPCOMING HOLIDAYS</h4>
              <div *ngFor="let holiday of futureHoliday | slice:0:2">
                <div class="row">
                  <div class="col-3">
                    <i class="fa fa-calendar f-50"></i>
                  </div>
                  <div class="col-9">
                    <h5>
                      {{ (this.datepipe.transform(holiday.date,"d MMM")).toUpperCase() }}
                    </h5>
                    <h5>
                      {{holiday.description}}
                    </h5>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Red Panel Upcoming Holidays-->
        </div>

      </div>
      <div class="row">
        <div class="col-12">
          <div id="chart_div" style="width: 100%; height: 300px;"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="col-lg-12 px-3 pb-3">
      <div class="border">
        <table class="table table-responsive-lg text-center table-striped">
          <thead>
            <tr>
              <th>
                FROM
              </th>
              <th>
                TO
              </th>
              <th>
                SPAN
              </th>
              <th>
                REASON
              </th>
              <th>
                PLANNED/ UNPLANNED
              </th>
              <th>
                LEAVE TYPE
              </th>
              <th>
                STATUS
              </th>
              <th *ngIf="!changeLeaveStatusFlag">
                EDIT/ CANCEL
              </th>
              <th *ngIf="changeLeaveStatusFlag">
                APPROVE/REJECT
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let leave of userLeaveList">
              <td>
                {{ this.datepipe.transform(leave.fromDate,"dd-MM-yyyy") }}
              </td>
              <td>
                {{ this.datepipe.transform(leave.toDate,"dd-MM-yyyy") }}
              </td>
              <td>
                {{leave.leaveCount}}
              </td>
              <td>
                {{leave.reason}}
              </td>
              <td>
                <span *ngIf="leave.leavePlanned">PLANNED</span>
                <span *ngIf="!leave.leavePlanned">UNPLANNED</span>
              </td>
              <td>
                {{leave.leaveType}}
              </td>
              <td>
                {{leave.leaveStatus}}
              </td>
              <td *ngIf="!changeLeaveStatusFlag">
                <button (click)="editLeave(leave)" class="btn btn-outline-dark"><i class="fa fa-pencil"
                    aria-hidden="true"></i></button>
                <span
                  *ngIf="(leave.leaveStatus == 'Approved' || leave.leaveStatus == 'Pending' ) && leave.cancelFlag== true">
                  |
                  <button (click)="cancelLeave(leave)" class="btn btn-outline-danger"><i class="fa fa-ban"
                      aria-hidden="true"></i></button>
                </span>

                <!-- <button (click)="deleteLeave(leave)" class="btn btn-outline-danger"> <i class="fa fa-trash"
                    aria-hidden="true"></i></button> -->

              </td>
              <td *ngIf="changeLeaveStatusFlag">
                <button (click)="editLeaveStatus(leave)" class="btn btn-outline-dark"><i class="fa fa-pencil"
                    aria-hidden="true"></i></button>
                <!-- | <button (click)="deleteLeave(leave)" class="btn btn-outline-danger"> <i class="fa fa-trash"
                    aria-hidden="true"></i></button> -->
              </td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>


<!-- Sandwiched Popup Modal -->

<div class="modal bd-example-modal-lg " id="sandwiched-popup" tabindex="-1" role="dialog"
  aria-labelledby="sandwichedLeave" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="alertdialog">
    <div class="modal-content">
      <div class="modal-header">

        <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button> -->
      </div>
      <div class="modal-body">

        <div class="row">
          <div class="col-3">
            <img src="/assets/img/sandwitch.png" width="100%">
          </div>
          <div class="col-9">
            <table class="h-100">
              <th class="align-middle">
                <h5 class="modal-title" id="sandwichedLeave">LEAVES ARE GETTING SANDWICHED</h5>
                <p>6 working days ELs can be availed at a stretch; Els availed for 7 or more than 7 consecutive
                  working days will be treated as a *Long Leave (sandwiched). Weekly-offs “WO” i.e. Saturdays & Sundays
                  falling within this leave-period will be considered a leave. Public Holidays falling in this
                  leave-period will not be considered as leave; here, leave-period refers to consecutive calendar days
                  from first day of leave to last day of leave. </p>
                  <p class="mb-0">Do you sill want to apply?</p>
              </th>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn bg-red" (click)="settabindex()" data-toggle="modal">Apply</button>
        <!-- data-target="#maternity-popup" -->
        <button type="button" class="btn btn-secondary" data-dismiss="modal">CANCEL</button>
      </div>
    </div>
  </div>
</div>

<!-- Maternity Popup Modal -->

<div class="modal bd-example-modal-lg " id="maternity-popup" tabindex="-1" role="dialog"
  aria-labelledby="maternityLeave" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="alertdialog">
    <div class="modal-content">
      <div class="modal-header">

        <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button> -->
      </div>
      <div class="modal-body">
        <h5 class="modal-title  text-center" id="maternityLeave">MATERNITY LEAVE EXCEEDING 80 DAYS</h5>
        <div class="row">
          <div class="col-3">
            <img src="/assets/img/CAUTION.png" width="100%">
          </div>
          <div class="col-9">
            <table class="h-100">
              <th class="align-middle">
                You can apply for maternity leave for not more than 80 days. <br>
                Do you sill want to apply?
              </th>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn bg-red" data-dismiss="modal">APPLY</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">CANCEL</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="errorFlag" class="text-center myAlert-top alert alert-danger alert-dismissible fade show" role="alert">
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
  {{this.errorMessage}}
</div>

<div *ngIf="successFlag" class="text-center myAlert-top alert alert-success alert-dismissible fade show" role="alert">
  {{this.successMessage}}
</div>

<div *ngIf="confirmationFlag" class="text-center myAlert-top alert alert-warning alert-dismissible fade show"
  role="alert">
  <p class="alert-heading">Are you sure to cancel leave</p>
  <hr>
  <button type="button" class="btn btn-outline-secondary" (click)="confirmCancelLeave()">
    Yes
  </button> &nbsp;
  <button type="button" class="btn btn-outline-danger" (click)="cancleCancelLeave()">
    No
  </button>
</div>